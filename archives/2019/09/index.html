<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  
  <title>Archives: 2019/9 | Kalan</title>
  <meta name="description" content>
  <meta name="keywords" content>
  <meta name="HandheldFriendly" content="True">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="shortcut icon" href="/">
  <link rel="alternate" href="/atom.xml" title="Kalan">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Kalan">
<meta property="og:url" content="https://kalanliao.github.io/archives/2019/09/index.html">
<meta property="og:site_name" content="Kalan">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Kalan">
    
  <link href="https://fonts.googleapis.com/css?family=Inconsolata|Titillium+Web" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
  <link href="//cdn.bootcss.com/node-waves/0.7.5/waves.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/style.css">
  <script>
    function setLoadingBarProgress(num) {
      document.getElementById('loading-bar').style.width=num+"%";
    }
  </script>
</head>
</html>
<body>
  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>


  <script>setLoadingBarProgress(20)</script> 
  <header class="l_header">
	<div class='wrapper'>
		<div class="nav-main container container--flex">
			<a class="logo flat-box" href='/' >
				Kalan
			</a>
			<div class='menu'>
				<ul class='h-list'>
					
						<li>
							<a class='flat-box nav-home' href='/'>
								Home
							</a>
						</li>
					
						<li>
							<a class='flat-box nav-archives' href='/archives'>
								Archives
							</a>
						</li>
					
						<li>
							<a class='flat-box nav-gallery' href='https://photos.google.com/album/AF1QipNoqKYgspQo5O1YhlFXGCQ7p575KBH3Yxf8WHL4?hl=zh-CN'>
								Gallery
							</a>
						</li>
					
						<li>
							<a class='flat-box nav-about' href='/about'>
								About
							</a>
						</li>
					
				</ul>
				<div class='underline'></div>
			</div>
			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="Search" />
						<span class="icon icon-search"></span>
					</form>
				</div>
			
			<ul class='switcher h-list'>
				
					<li class='s-search'><a href='javascript:void(0)'><span class="icon icon-search flat-box"></span></a></li>
				
				<li class='s-menu'><a href='javascript:void(0)'><span class="icon icon-menu flat-box"></span></a></li>
			</ul>
		</div>
		
		<div class='nav-sub container container--flex'>
			<a class="logo" class="flat-box" href='javascript:void(0)'>
				Word of Forks
			</a>

			<ul class='switcher h-list'>
				<li class='s-comment'><a href='javascript:void(0)'><span class="icon icon-chat_bubble_outline flat-box"></span></a></li>
				<li class='s-top'><a href='javascript:void(0)'><span class="icon icon-arrow_upward flat-box"></span></a></li>
				<li class='s-toc'><a href='javascript:void(0)'><span class="icon icon-format_list_numbered flat-box"></span></a></li>
			</ul>
		</div>
	</div>
</header>
<aside class="menu-phone">
	<nav>
		
			<a href="/" class="nav-home nav">
				Home
			</a>
		
			<a href="/archives" class="nav-archives nav">
				Archives
			</a>
		
			<a href="https://photos.google.com/album/AF1QipNoqKYgspQo5O1YhlFXGCQ7p575KBH3Yxf8WHL4?hl=zh-CN" class="nav-gallery nav">
				Gallery
			</a>
		
			<a href="/about" class="nav-about nav">
				About
			</a>
		
	</nav>
</aside>

    <script>setLoadingBarProgress(40);</script>
  <div class="l_body">
    <div class='container clearfix'>
      <div class='l_main'>
        
	
  <script>
    window.subData= { title:'Year : 2019.9'}
  </script>

<section class="post-list">
	
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/2019/09/23/netcore/netcore3-0-enum-flagsattr/">
        Enum中FlagsAttribute的应用
      </a>
    </h2>
    
    <time>
      Sep 23, 2019
    </time>
		
    
    <div class='cats'>
        <a href="/categories/NetCore/">NetCore</a>
    </div>

  </section>
  <section class="article typo">
	  <p>应用Enum的FlagsAttribute标签能做很多应用，可以使枚举获得多个判断的效果<br>下面这段代码：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Flags</span>]</span><br><span class="line">    <span class="keyword">enum</span> WeekDays</span><br><span class="line">    &#123; </span><br><span class="line">        Monday = <span class="number">0x1</span>,</span><br><span class="line">        Tuesday = <span class="number">0x2</span>,</span><br><span class="line">        Wednesday = <span class="number">0x4</span>,</span><br><span class="line">        Thursday = <span class="number">0x8</span>,</span><br><span class="line">        Friday = <span class="number">0x10</span>,</span><br><span class="line">        Saturday = <span class="number">0x20</span>,</span><br><span class="line">        Sunday = <span class="number">0x40</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>同样的我们也可以这么写</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Flags</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">enum</span> WeekDays</span><br><span class="line">    &#123;</span><br><span class="line">        Monday = <span class="number">1</span>,</span><br><span class="line">        Tuesday = <span class="number">2</span>,</span><br><span class="line">        Wednesday = <span class="number">4</span>,</span><br><span class="line">        Thursday = <span class="number">8</span>,</span><br><span class="line">        Friday = <span class="number">16</span>,</span><br><span class="line">        Saturday = <span class="number">32</span>,</span><br><span class="line">        Sunday = <span class="number">64</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>这里会用到我们位运算的特性</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">WeekDays wds = WeekDays.Monday | WeekDays.Sunday | WeekDays.Tuesday;</span><br><span class="line"><span class="comment">/* 我们来看看计算过程:</span></span><br><span class="line"><span class="comment"> * 或运算:</span></span><br><span class="line"><span class="comment">     0000 0001 --星期一 0x1</span></span><br><span class="line"><span class="comment">  或 0010 0000 --星期六 0x20</span></span><br><span class="line"><span class="comment">  或 0000 0010 --星期二 0x2</span></span><br><span class="line"><span class="comment"> =   0010 0011 = 35</span></span><br><span class="line"><span class="comment"> *换句话说: 某个位是1就代表了这个位上的值在枚举中存在</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">Console.WriteLine(<span class="string">"这3天组合Int为: "</span> + (<span class="keyword">int</span>)wds);</span><br><span class="line"><span class="comment">/*利用上面规则来判断枚举值中是否包含某个枚举值就轻而易举*/</span></span><br><span class="line"><span class="keyword">if</span> ((wds &amp; WeekDays.Monday) != <span class="number">0</span>)</span><br><span class="line">    Console.WriteLine(<span class="string">"星期一是其中一天"</span>);</span><br><span class="line"><span class="keyword">if</span> ((wds &amp; WeekDays.Saturday) == <span class="number">0</span>)</span><br><span class="line">    Console.WriteLine(<span class="string">"星期六不是其中一天"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//(补充)如果将某个值去掉的话可以按照原来采用这次方式</span></span><br><span class="line"><span class="comment">/* 将星期六从枚举变量中去掉</span></span><br><span class="line"><span class="comment"> *  0010 0011</span></span><br><span class="line"><span class="comment"> * &amp;1011 1111 (~WeekDays.Monday)取反</span></span><br><span class="line"><span class="comment"> * =0000 0011 这样就把星期一去掉啦!</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">wds = wds &amp; (~WeekDays.Monday);</span><br><span class="line">Console.WriteLine(<span class="string">"去掉星期一后的效果: "</span> + wds);</span><br></pre></td></tr></table></figure>

<p>到这里我们看到可以联想到可以用这个枚举来做一些简单的页面权限的判断<br>比如我们有下面这些权限</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Flags</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> Permissions</span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">Description(<span class="meta-string">"未設定"</span>)</span>]</span><br><span class="line">    None = <span class="number">0</span>,</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Description(<span class="meta-string">"建立"</span>)</span>]</span><br><span class="line">    Create = <span class="number">1</span>,</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Description(<span class="meta-string">"讀取"</span>)</span>]</span><br><span class="line">    Read = <span class="number">2</span>,</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Description(<span class="meta-string">"更新"</span>)</span>]</span><br><span class="line">    Update = <span class="number">4</span>,</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Description(<span class="meta-string">"刪除"</span>)</span>]</span><br><span class="line">    Delete = <span class="number">8</span>,</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Description(<span class="meta-string">"所有功能"</span>)</span>]</span><br><span class="line">    All = Create | Read | Update | Delete</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>通过下面的判断方法来进行权限判断</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Permissions permission = Permissions.None;</span><br><span class="line">permission = permission | Permissions.Create;</span><br><span class="line">MessageBox.Show(permission.ToString());</span><br><span class="line"><span class="comment">// Result: Create</span></span><br><span class="line">permission = permission | Permissions.Read;</span><br><span class="line">permission = permission | Permissions.Update;</span><br><span class="line">MessageBox.Show(permission.ToString());</span><br><span class="line"><span class="comment">// Result: Create, Read, Update</span></span><br><span class="line">permission = (permission &amp; (Permissions.All ^ Permissions.Read));</span><br><span class="line">MessageBox.Show(permission.ToString());</span><br><span class="line"><span class="comment">// Result: Create, Update</span></span><br></pre></td></tr></table></figure>

    
    
    
	  <div class="full-width auto-padding tags">
      
        <a href="/tags/C/">C#</a>
      
        <a href="/tags/NetCore/">NetCore</a>
      
	  </div>
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/2019/09/19/creed/Jack-Ma01/">
        马云离职语录
      </a>
    </h2>
    
    <time>
      Sep 19, 2019
    </time>
		
    
    <div class='cats'>
        <a href="/categories/信条/">信条</a>
    </div>

  </section>
  <section class="article typo">
	  <h1 id="马云：我最遗憾的错误"><a href="#马云：我最遗憾的错误" class="headerlink" title="马云：我最遗憾的错误"></a>马云：我最遗憾的错误</h1><p>01年，我犯了一个错误，我告诉我的18位共同创业同仁，他们只能做小组经理，而所有的副总裁都得从外面聘请。现在十年过去了，我从外面聘请的人才都走了，而我之前曾怀疑过其能力的人都成了副总或董事。我相信两个信条：态度比能力重要，选择同样也比能力重要！</p>
<h1 id="马云：不能统一人的思想，但可以统一人的目标"><a href="#马云：不能统一人的思想，但可以统一人的目标" class="headerlink" title="马云：不能统一人的思想，但可以统一人的目标"></a>马云：不能统一人的思想，但可以统一人的目标</h1><p>千万不要相信你能统一人的思想，那是不可能的。30%的人永远不可能相信你，不要让你的同事为你干活，而让他们为我们的共同目标干活。团结在一个共同的目标下，要比团结在一个人周围容易的多。</p>
<h1 id="马云提醒：细节好的人格局一般都差"><a href="#马云提醒：细节好的人格局一般都差" class="headerlink" title="马云提醒：细节好的人格局一般都差"></a>马云提醒：细节好的人格局一般都差</h1><ol>
<li>有人觉得我牛，6分钟说服了孙正义，其实是他说服了我。见孙正义之前，我在硅谷至少被拒绝了40次。</li>
<li>做企业赢在细节，输在格局。</li>
<li>格局，“格”是人格，“局”是胸怀，细节好的人格局一般都差，格局好的人从来不重细节，两个都干好，那叫太有才！</li>
</ol>
<h1 id="马云：领导比员工多什么？"><a href="#马云：领导比员工多什么？" class="headerlink" title="马云：领导比员工多什么？"></a>马云：领导比员工多什么？</h1><p>领导永远不要跟下属比技能，下属肯定比你强；如果不比你强，说明你请错人了。</p>
<ol>
<li>要比眼光：比他看得远；</li>
<li>要比胸怀：领导的胸怀是委屈撑大的，要能容人所不容；</li>
<li>要比实力：抗失败的能力比他强；一个优秀的领导人的素质就是眼光、胸怀和实力。</li>
</ol>
<h1 id="马云：中国商人千万别在“红道”上混"><a href="#马云：中国商人千万别在“红道”上混" class="headerlink" title="马云：中国商人千万别在“红道”上混"></a>马云：中国商人千万别在“红道”上混</h1><ol>
<li>人一辈子要明白钱和权两个东西是绝对不要碰在一起，当了官永远不要想有钱，当了商人千万别想权；</li>
<li>钱和权这两个东西碰在一起就是炸药和雷管碰在一起，必然要爆炸；</li>
<li>胡雪岩的悲哀就在于他是红顶商人；④中国商人千万别在“红道”上混。</li>
</ol>
<h1 id="马云：年轻人必须思考的4大问题"><a href="#马云：年轻人必须思考的4大问题" class="headerlink" title="马云：年轻人必须思考的4大问题"></a>马云：年轻人必须思考的4大问题</h1><ol>
<li><p>什么是失败？放弃就是最大的失败。</p>
</li>
<li><p>什么叫坚强？经历许多磨难、委屈、不爽，你才知道什么叫坚强。</p>
</li>
<li><p>你的职责是什么？比别人多勤奋一点、多努力一点、多一点理想，这就是你的职责。</p>
</li>
<li><p>傻瓜用嘴讲话，聪明人用脑袋讲话，智者用心讲话。</p>
</li>
</ol>
<h1 id="马云：人生在世在做人，不是做事"><a href="#马云：人生在世在做人，不是做事" class="headerlink" title="马云：人生在世在做人，不是做事"></a>马云：人生在世在做人，不是做事</h1><p>我跟自己讲我们到这个世界上不是来工作的，我们是来享受人生的，我们是来做人不是做事。</p>
<p>如果一辈子都做事的话，忘了做人，将来一定会后悔。</p>
<p>不管事业多成功、多伟大、多了不起，记住我们到这个世界就是享受经历这个人生的体验。</p>
<p>忙着做事一定会后悔。</p>
<h1 id="马云：高手的竞争论"><a href="#马云：高手的竞争论" class="headerlink" title="马云：高手的竞争论"></a>马云：高手的竞争论</h1><ol>
<li><p>一定要争得你死我活的商战，是最愚蠢的。</p>
</li>
<li><p>眼睛中全是敌人，外面就全是敌人。</p>
</li>
<li><p>竞争的时候不要带仇恨，带仇恨一定失败。</p>
</li>
<li><p>竞争乐趣就像下棋一样，你输了，我们再来过，两个棋手不能打架。</p>
</li>
<li><p>真正做企业是没有仇人的，心中无敌，天下无敌。</p>
</li>
</ol>
<h1 id="马云：别把抱怨当习惯"><a href="#马云：别把抱怨当习惯" class="headerlink" title="马云：别把抱怨当习惯"></a>马云：别把抱怨当习惯</h1><p>人是退化最严重的动物。跟兽比人很“弱肢”，和狗比人很“闻盲”，但人类“进化”了抱怨。</p>
<p>偶尔为之无大碍，但当抱怨成习惯，就如喝海水，喝的越多渴得越厉害。</p>
<p>最后发现，走在成功路上的，都是些不抱怨的“傻子们”。</p>
<p>世界不会记得你说了什么，但一定不会忘记你做了什么！</p>
<h1 id="马云给初创企业者的忠告"><a href="#马云给初创企业者的忠告" class="headerlink" title="马云给初创企业者的忠告"></a>马云给初创企业者的忠告</h1><ol>
<li><p>大家看不清的机会，才是真正的机会。</p>
</li>
<li><p>让员工笑着干活。</p>
</li>
<li><p>客户第一、员工第二、股东第三。</p>
</li>
<li><p>抢在变化之前先变。</p>
</li>
<li><p>忘掉money，忘掉赚钱。</p>
</li>
<li><p>小聪明不如傻坚持。</p>
</li>
<li><p>心态决定姿态，姿态决定状态。</p>
</li>
</ol>
<h1 id="马云谈创业"><a href="#马云谈创业" class="headerlink" title="马云谈创业"></a>马云谈创业</h1><ol>
<li><p>一个好的东西往往是说不清楚的，说得清楚的往往不是好东西！</p>
</li>
<li><p>创业要找最合适的人，不一定要找最成功的人。</p>
</li>
<li><p>这世界最不可靠的东西就是关系。</p>
</li>
<li><p>免费是世界上最昂贵的东西。</p>
</li>
<li><p>今天很残酷，明天更残酷，后天很美好。</p>
</li>
</ol>
<h1 id="马云“四不”创业智慧"><a href="#马云“四不”创业智慧" class="headerlink" title="马云“四不”创业智慧"></a>马云“四不”创业智慧</h1><ol>
<li><p>创业最怕就是看不见，看不起，看不懂，跟不上；</p>
</li>
<li><p>看不见对手在哪里，看不起对手，看不懂对手为什么可以变得那么强，然后就跟不上了；</p>
</li>
<li><p>即使对手很弱小，也一定要把对方看的很强大，即使对手很强大，也不一定要把自己看的很弱小。</p>
</li>
</ol>
<h1 id="马云当你决定要创业时"><a href="#马云当你决定要创业时" class="headerlink" title="马云当你决定要创业时"></a>马云当你决定要创业时</h1><p>便意味着：</p>
<ol>
<li>没有了稳定的收入；②没有了请假的权利；③没有了得红包的机会。</li>
</ol>
<p>然而却更意味着：</p>
<ol start="2">
<li>收入不再受限制；②时间运用更有效；③手心向下不求人。</li>
</ol>
<p>想法若不同，结果便不同；选择不一样，生活才变样。</p>
<h1 id="马云谈机会"><a href="#马云谈机会" class="headerlink" title="马云谈机会"></a>马云谈机会</h1><p>如果一个方案有90%的人说“好”的话，我一定要把它扔到垃圾桶里去。</p>
<p>因为这么多人说好的方案，必然有很多人在做了，机会肯定不会是我们的了。</p>


    
    
    
	  <div class="full-width auto-padding tags">
      
        <a href="/tags/马云-Jack-MA/">马云,Jack MA</a>
      
	  </div>
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/2019/09/19/netcore/netcore3-0-context-gc/">
        .NET Core 3.0 可回收程序集加载上下文
      </a>
    </h2>
    
    <time>
      Sep 19, 2019
    </time>
		
    
    <div class='cats'>
        <a href="/categories/NetCore/">NetCore</a>
    </div>

  </section>
  <section class="article typo">
	  <h1 id="前世今生"><a href="#前世今生" class="headerlink" title="前世今生"></a>前世今生</h1><p>.NET诞生以来，程序集的动态加载和卸载都是一个Hack的技术，之前的NetFx都是使用AppDomain的方式去加载程序集，然而AppDomain并没有提供直接卸载一个程序集的API，而是要卸载整个AppDomain才能卸载包含在其中的所有程序集。然而卸载整个CurrentAppDomain会使程序不能工作。</p>
<p>可能有人另辟西经，创建别一个AppDomain来加载/卸载程序集，但是由于程序集之间是不能跨域访问的，也导致只能通过Remote Proxy的方式去访问，这样在类型创建和使用上带来了一定的难度也是类型的继承变得相当复杂。</p>
<p>.NET Core中一直没有AppDomain的支持。但是在.NET Core 3.0中，我最期待的一个特性就是对可收集程序集的支持(Collectible AssemblyLoadContext)。 众所周知.NET Core中一直使用AssemblyLoadContext的API，来进行程序集的动态加载，但是并没有提供Unload的方法，此次升级更新了这方面的能力。</p>
<h1 id="AssemblyLoadContext"><a href="#AssemblyLoadContext" class="headerlink" title="AssemblyLoadContext"></a>AssemblyLoadContext</h1><p>其实这次AssemblyLoadContext的设计，我认为更像是Java中ClassLoader的翻版，可以说非常类似。在使用过程中自定义AssemblyLoadContext可以内部管理其中的程序集，并对整体Context进行Unload。使用AssemblyLoadContext也可以避免程序集名称和版本的冲突。</p>
<h1 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h1><p>.NET Core 3.0还没有正式版，所有要使用预览版的SDK完成以下实例。我使用的是.NET Core SDK 3.0.100-preview-009812</p>
<p><code>dotnet new globaljson --sdk-version 3.0.100-preview-009812</code></p>
<p>AssemblyLoadContext是一个抽象类的，我们需要子类化。下面显示的是我们创建自定义AssemblyLoadContext的方法,实现一个可回收的Context需要在构造器中指定isCollectible: true ：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">CollectibleAssemblyLoadContext</span> : <span class="title">AssemblyLoadContext</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CollectibleAssemblyLoadContext</span>(<span class="params"></span>) : <span class="title">base</span>(<span class="params">isCollectible: <span class="literal">true</span></span>)</span></span><br><span class="line"><span class="function"></span>    &#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">override</span> Assembly <span class="title">Load</span>(<span class="params">AssemblyName assemblyName</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用netstandard2.0创建一个library</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">SampleLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SayHello</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Hello</span>(<span class="params"><span class="keyword">int</span> iteration</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">$"Hello <span class="subst">&#123;iteration&#125;</span>!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试Load/Unload</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> context = <span class="keyword">new</span> CollectibleAssemblyLoadContext();</span><br><span class="line"><span class="keyword">var</span> assemblyPath = Path.Combine(Directory.GetCurrentDirectory(),<span class="string">"SampleLibrary.dll"</span>);</span><br><span class="line"><span class="keyword">using</span> (<span class="keyword">var</span> fs = <span class="keyword">new</span> FileStream(assemblyPath, FileMode.Open, FileAccess.Read))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> assembly = context.LoadFromStream(fs);</span><br><span class="line">    <span class="keyword">var</span> type = assembly.GetType(<span class="string">"SampleLibrary.SayHello"</span>);</span><br><span class="line">    <span class="keyword">var</span> greetMethod = type.GetMethod(<span class="string">"Hello"</span>);</span><br><span class="line">    <span class="keyword">var</span> instance = Activator.CreateInstance(type);</span><br><span class="line">    greetMethod.Invoke(instance, <span class="keyword">new</span> <span class="keyword">object</span>[] &#123; i &#125;);</span><br><span class="line">&#125;</span><br><span class="line">context.Unload();</span><br><span class="line">GC.Collect();</span><br><span class="line">GC.WaitForPendingFinalizers();</span><br></pre></td></tr></table></figure>

<p>当执行GC收回后，加载的程序集会被完全的回收。</p>


    
    
    
	  <div class="full-width auto-padding tags">
      
        <a href="/tags/C/">C#</a>
      
        <a href="/tags/NetCore/">NetCore</a>
      
	  </div>
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/2019/09/18/collect/regex/">
        正则大全收藏
      </a>
    </h2>
    
    <time>
      Sep 18, 2019
    </time>
		
    
    <div class='cats'>
        <a href="/categories/Collect/">Collect</a>
    </div>

  </section>
  <section class="article typo">
	  <h1 id="校验数字的表达式"><a href="#校验数字的表达式" class="headerlink" title="校验数字的表达式"></a>校验数字的表达式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">1 数字：^[0-9]*$</span><br><span class="line"></span><br><span class="line">2 n位的数字：^\d&#123;n&#125;$</span><br><span class="line"></span><br><span class="line">3 至少n位的数字：^\d&#123;n,&#125;$</span><br><span class="line"></span><br><span class="line">4 m-n位的数字：^\d&#123;m,n&#125;$</span><br><span class="line"></span><br><span class="line">5 零和非零开头的数字：^(0|[1-9][0-9]*)$</span><br><span class="line"></span><br><span class="line">6 非零开头的最多带两位小数的数字：^([1-9][0-9]*)+(.[0-9]&#123;1,2&#125;)?$</span><br><span class="line"></span><br><span class="line">7 带1-2位小数的正数或负数：^(-)?\d+(.\d&#123;1,2&#125;)?$</span><br><span class="line"></span><br><span class="line">8 正数、负数、和小数：^(-|+)?\d+(.\d+)?$</span><br><span class="line"></span><br><span class="line">9 有两位小数的正实数：^[0-9]+(.[0-9]&#123;2&#125;)?$</span><br><span class="line"></span><br><span class="line">10 有1~3位小数的正实数：^[0-9]+(.[0-9]&#123;1,3&#125;)?$</span><br><span class="line"></span><br><span class="line">11 非零的正整数：^[1-9]\d$ 或 ^([1-9][0-9])&#123;1,3&#125;$ 或 ^+?[1-9][0-9]*$</span><br><span class="line"></span><br><span class="line">12 非零的负整数：^-[1-9][]0-9&quot;$ 或 ^-[1-9]\d$</span><br><span class="line"></span><br><span class="line">13 非负整数：^\d+$ 或 ^[1-9]\d*|0$</span><br><span class="line"></span><br><span class="line">14 非正整数：^-[1-9]\d*|0$ 或 ^((-\d+)|(0+))$</span><br><span class="line"></span><br><span class="line">15 非负浮点数：^\d+(.\d+)?$ 或 ^[1-9]\d.\d|0.\d[1-9]\d|0?.0+|0$</span><br><span class="line"></span><br><span class="line">16 非正浮点数：^((-\d+(.\d+)?)|(0+(.0+)?))$ 或 ^(-([1-9]\d.\d|0.\d[1-9]\d))|0?.0+|0$</span><br><span class="line"></span><br><span class="line">17 正浮点数：^[1-9]\d.\d|0.\d[1-9]\d$ 或 ^(([0-9]+.[0-9][1-9][0-9])|([0-9][1-9][0-9].[0-9]+)|([0-9][1-9][0-9]))$</span><br><span class="line"></span><br><span class="line">18 负浮点数：^-([1-9]\d.\d|0.\d[1-9]\d)$ 或 ^(-(([0-9]+.[0-9][1-9][0-9])|([0-9][1-9][0-9].[0-9]+)|([0-9][1-9][0-9])))$</span><br><span class="line"></span><br><span class="line">19 浮点数：^(-?\d+)(.\d+)?$ 或 ^-?([1-9]\d.\d|0.\d[1-9]\d|0?.0+|0)$</span><br></pre></td></tr></table></figure>

<h1 id="校验字符的表达式"><a href="#校验字符的表达式" class="headerlink" title="校验字符的表达式"></a>校验字符的表达式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">1 汉字：^[\u4e00-\u9fa5]&#123;0,&#125;$</span><br><span class="line"></span><br><span class="line">2 英文和数字：^[A-Za-z0-9]+$ 或 ^[A-Za-z0-9]&#123;4,40&#125;$</span><br><span class="line"></span><br><span class="line">3 长度为3-20的所有字符：^.&#123;3,20&#125;$</span><br><span class="line"></span><br><span class="line">4 由26个英文字母组成的字符串：^[A-Za-z]+$</span><br><span class="line"></span><br><span class="line">5 由26个大写英文字母组成的字符串：^[A-Z]+$</span><br><span class="line"></span><br><span class="line">6 由26个小写英文字母组成的字符串：^[a-z]+$</span><br><span class="line"></span><br><span class="line">7 由数字和26个英文字母组成的字符串：^[A-Za-z0-9]+$</span><br><span class="line"></span><br><span class="line">8 由数字、26个英文字母或者下划线组成的字符串：^\w+$ 或 ^\w&#123;3,20&#125;$</span><br><span class="line"></span><br><span class="line">9 中文、英文、数字包括下划线：^[\u4E00-\u9FA5A-Za-z0-9_]+$</span><br><span class="line"></span><br><span class="line">10 中文、英文、数字但不包括下划线等符号：^[\u4E00-\u9FA5A-Za-z0-9]+$ 或 ^[\u4E00-\u9FA5A-Za-z0-9]&#123;2,20&#125;$</span><br><span class="line"></span><br><span class="line">11 可以输入含有^%&amp;&apos;,;=?$\&quot;等字符：[^%&amp;&apos;,;=?$\x22]+</span><br><span class="line"></span><br><span class="line">12 禁止输入含有~的字符：[^~\x22]+</span><br></pre></td></tr></table></figure>

<h1 id="特殊需求表达式"><a href="#特殊需求表达式" class="headerlink" title="特殊需求表达式"></a>特殊需求表达式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">1 Email地址：^\w+([-+.]\w+)@\w+([-.]\w+).\w+([-.]\w+)*$</span><br><span class="line"></span><br><span class="line">2 域名：[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;(/.[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;)+/.?</span><br><span class="line"></span><br><span class="line">3 InternetURL：[a-zA-z]+://[^\s] 或 ^http://([\w-]+\.)+[\w-]+(/[\w-./?%&amp;=])?$</span><br><span class="line"></span><br><span class="line">4 手机号码：^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d&#123;8&#125;$</span><br><span class="line">5 电话号码(&quot;XXX-XXXXXXX&quot;、&quot;XXXX-XXXXXXXX&quot;、&quot;XXX-XXXXXXX&quot;、&quot;XXX-XXXXXXXX&quot;、&quot;XXXXXXX&quot;和&quot;XXXXXXXX)：^((\d&#123;3,4&#125;-)|\d&#123;3.4&#125;-)?\d&#123;7,8&#125;$</span><br><span class="line"></span><br><span class="line">6 国内电话号码(0511-4405222、021-87888822)：\d&#123;3&#125;-\d&#123;8&#125;|\d&#123;4&#125;-\d&#123;7&#125;</span><br><span class="line"></span><br><span class="line">7 身份证号(15位、18位数字)：^\d&#123;15&#125;|\d&#123;18&#125;$</span><br><span class="line"></span><br><span class="line">8 短身份证号码(数字、字母x结尾)：^([0-9])&#123;7,18&#125;(x|X)?$ 或 ^\d&#123;8,18&#125;|[0-9x]&#123;8,18&#125;|[0-9X]&#123;8,18&#125;?$</span><br><span class="line"></span><br><span class="line">9 帐号是否合法(字母开头，允许5-16字节，允许字母数字下划线)：^[a-zA-Z][a-zA-Z0-9_]&#123;4,15&#125;$</span><br><span class="line"></span><br><span class="line">10 密码(以字母开头，长度在6~18之间，只能包含字母、数字和下划线)：^[a-zA-Z]\w&#123;5,17&#125;$</span><br><span class="line"></span><br><span class="line">11 强密码(必须包含大小写字母和数字的组合，不能使用特殊字符，长度在8-10之间)：^(?=.\d)(?=.[a-z])(?=.*[A-Z]).&#123;8,10&#125;$</span><br><span class="line"></span><br><span class="line">12 日期格式：^\d&#123;4&#125;-\d&#123;1,2&#125;-\d&#123;1,2&#125;</span><br><span class="line"></span><br><span class="line">13 一年的12个月(01～09和1～12)：^(0?[1-9]|1[0-2])$</span><br><span class="line"></span><br><span class="line">14 一个月的31天(01～09和1～31)：^((0?[1-9])|((1|2)[0-9])|30|31)$</span><br><span class="line"></span><br><span class="line">15 钱的输入格式：</span><br><span class="line"></span><br><span class="line">16 1.有四种钱的表示形式我们可以接受:&quot;10000.00&quot; 和 &quot;10,000.00&quot;, 和没有 &quot;分&quot; 的 &quot;10000&quot; 和 &quot;10,000&quot;：^[1-9][0-9]*$</span><br><span class="line"></span><br><span class="line">17 2.这表示任意一个不以0开头的数字,但是,这也意味着一个字符&quot;0&quot;不通过,所以我们采用下面的形式：^(0|[1-9][0-9]*)$</span><br><span class="line"></span><br><span class="line">18 3.一个0或者一个不以0开头的数字.我们还可以允许开头有一个负号：^(0|-?[1-9][0-9]*)$</span><br><span class="line"></span><br><span class="line">19 4.这表示一个0或者一个可能为负的开头不为0的数字.让用户以0开头好了.把负号的也去掉,因为钱总不能是负的吧.下面我们要加的是说明可能的小数部分：^[0-9]+(.[0-9]+)?$</span><br><span class="line"></span><br><span class="line">20 5.必须说明的是,小数点后面至少应该有1位数,所以&quot;10.&quot;是不通过的,但是 &quot;10&quot; 和 &quot;10.2&quot; 是通过的：^[0-9]+(.[0-9]&#123;2&#125;)?$</span><br><span class="line"></span><br><span class="line">21 6.这样我们规定小数点后面必须有两位,如果你认为太苛刻了,可以这样：^[0-9]+(.[0-9]&#123;1,2&#125;)?$</span><br><span class="line"></span><br><span class="line">22 7.这样就允许用户只写一位小数.下面我们该考虑数字中的逗号了,我们可以这样：^[0-9]&#123;1,3&#125;(,[0-9]&#123;3&#125;)*(.[0-9]&#123;1,2&#125;)?$</span><br><span class="line"></span><br><span class="line">23 8.1到3个数字,后面跟着任意个 逗号+3个数字,逗号成为可选,而不是必须：^([0-9]+|[0-9]&#123;1,3&#125;(,[0-9]&#123;3&#125;)*)(.[0-9]&#123;1,2&#125;)?$</span><br><span class="line"></span><br><span class="line">24 备注：这就是最终结果了,别忘了&quot;+&quot;可以用&quot;*&quot;替代如果你觉得空字符串也可以接受的话(奇怪,为什么?)最后,别忘了在用函数时去掉去掉那个反斜杠,一般的错误都在这里</span><br><span class="line"></span><br><span class="line">25 xml文件：^([a-zA-Z]+-?)+[a-zA-Z0-9]+\.[x|X][m|M][l|L]$</span><br><span class="line"></span><br><span class="line">26 中文字符的正则表达式：[\u4e00-\u9fa5]</span><br><span class="line"></span><br><span class="line">27 双字节字符：[^\x00-\xff] (包括汉字在内，可以用来计算字符串的长度(一个双字节字符长度计2，ASCII字符计1))</span><br><span class="line"></span><br><span class="line">28 空白行的正则表达式：\n\s*\r (可以用来删除空白行)</span><br><span class="line"></span><br><span class="line">29 HTML标记的正则表达式：&lt;(\S?)[^&gt;]&gt;.?&lt;/\1&gt;|&lt;.? /&gt; (网上流传的版本太糟糕，上面这个也仅仅能部分，对于复杂的嵌套标记依旧无能为力)</span><br><span class="line"></span><br><span class="line">30 首尾空白字符的正则表达式：^\s|\s$或(^\s)|(\s$) (可以用来删除行首行尾的空白字符(包括空格、制表符、换页符等等)，非常有用的表达式)</span><br><span class="line"></span><br><span class="line">31 腾讯QQ号：[1-9][0-9]&#123;4,&#125; (腾讯QQ号从10000开始)</span><br><span class="line"></span><br><span class="line">32 中国邮政编码：[1-9]\d&#123;5&#125;(?!\d) (中国邮政编码为6位数字)</span><br><span class="line"></span><br><span class="line">33 IP地址：\d+.\d+.\d+.\d+ (提取IP地址时有用)</span><br><span class="line"></span><br><span class="line">34 IP地址：((?:(?:25[0-5]|2[0-4]\d|[01]?\d?\d)\.)&#123;3&#125;(?:25[0-5]|2[0-4]\d|[01]?\d?\d))</span><br></pre></td></tr></table></figure>

    
    
    
	  <div class="full-width auto-padding tags">
      
        <a href="/tags/regex/">regex</a>
      
	  </div>
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/2019/09/18/javascript/javascript-study-02/">
        javascript学习-02(跨域原理)
      </a>
    </h2>
    
    <time>
      Sep 18, 2019
    </time>
		
    
    <div class='cats'>
        <a href="/categories/JavaScript/">JavaScript</a>
    </div>

  </section>
  <section class="article typo">
	  <h1 id="跨域请求的含义"><a href="#跨域请求的含义" class="headerlink" title="跨域请求的含义"></a>跨域请求的含义</h1><p>浏览器的同源策略，出于防范跨站脚本的攻击，禁止客户端脚本（如 JavaScript）对不同域的服务进行跨站调用。</p>
<p>一般的，只要网站的 协议名protocol、 主机host、 端口号port 这三个中的任意一个不同，网站间的数据请求与传输便构成了跨域调用。这也是我们下面实践的理论基础。我们利用 NodeJs 创建了两个服务器，分别监听 3000、 3001 端口（下面简称 服务器3000 与 服务器3001 ），由于端口号不一样，这两个服务器以及服务器上页面通信构成了跨域请求。</p>
<p>在服务器3000 有一个登录页面，页面的请求代码是这样的</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">"#submit"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> data = &#123;</span><br><span class="line">            name: $(<span class="string">"#name"</span>).val(),</span><br><span class="line">            id: $(<span class="string">"#id"</span>).val()</span><br><span class="line">        &#125;;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            type: <span class="string">'POST'</span>,</span><br><span class="line">            data: data,</span><br><span class="line">            url: <span class="string">'http://localhost:3000/ajax/deal'</span>,</span><br><span class="line">            dataType: <span class="string">'json'</span>,</span><br><span class="line">            cache: <span class="literal">false</span>,</span><br><span class="line">            timeout: <span class="number">5000</span>,</span><br><span class="line">            success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(data)</span><br><span class="line">            &#125;,</span><br><span class="line">            error: <span class="function"><span class="keyword">function</span>(<span class="params">jqXHR, textStatus, errorThrown</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'error '</span> + textStatus + <span class="string">' '</span> + errorThrown);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>处理函数为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pp.post(<span class="string">'/ajax/deal'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"server accept: "</span>, req.body.name, req.body.id)</span><br><span class="line">    <span class="keyword">var</span> data = &#123;</span><br><span class="line">        name: req.body.name + <span class="string">' - server 3000 process'</span>,</span><br><span class="line">        id: req.body.id + <span class="string">' - server 3000 process'</span></span><br><span class="line">    &#125;</span><br><span class="line">    res.send(data)</span><br><span class="line">    res.end()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>结果为：<br><img src="/images/javascript-study-02/1.jpg" alt="结果"><br>此处数据处理成功。</p>
<p>由于数据请求一般都是由页面发送数据字段，服务器根据这些字段作相应的处理，如数据库查询，字符串操作等等。所以我们这里简单的处理数据（在数据后面加上字符串‘server 3000 process’），并且返回给浏览器，表示数据经过服务器端处理。<br>如果让 服务器3000 上的页面向 服务器 3001 发起请求会怎样呢？</p>
<p>将请求页面中的 ajax 请求路径改为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(&#123;</span><br><span class="line">    ...</span><br><span class="line">    url: <span class="string">'http://localhost:3001/ajax/deal'</span>,</span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>服务器3001 对应的处理函数与 服务器3000 类似：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/ajax/deal'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"server accept: "</span>, req.body.name, req.body.id)</span><br><span class="line">    <span class="keyword">var</span> data = &#123;</span><br><span class="line">        name: req.body.name + <span class="string">' - server 3001 process'</span>,</span><br><span class="line">        id: req.body.id + <span class="string">' - server 3001 process'</span></span><br><span class="line">    &#125;</span><br><span class="line">    res.send(data)</span><br><span class="line">    res.end()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="/images/javascript-study-02/2.jpg" alt="结果"><br>结果证明了我们上面所说的端口号不同，发生了跨域请求的调用。</p>
<p>需要注意的是，服务器 3001 控制台有输出：</p>
<p><code>server accept:  chiaki 3001</code><br>这说明跨域请求并非是浏览器限制了发起跨站请求，而是请求可以正常发起，到达服务器端，但是服务器返回的结果会被浏览器拦截。</p>
<h1 id="利用-JSONP-实现跨域调用"><a href="#利用-JSONP-实现跨域调用" class="headerlink" title="利用 JSONP 实现跨域调用"></a>利用 JSONP 实现跨域调用</h1><p>说道跨域调用，可能大家首先想到的或者听说过的就是 JSONP 了。</p>
<h2 id="什么是JSONP"><a href="#什么是JSONP" class="headerlink" title="什么是JSONP"></a>什么是JSONP</h2><p>来看一下原文</p>
<pre><code>JSONP (JSON with Padding or JSON-P) is a JSON extension used by web developers to overcome the cross-domain restrictions imposed by browsers’ same-origin policy that limits access to resources retrieved from origins other than the one the page was served by. In layman’s terms, one website cannot just simply access the data from another website.

It was developed because handling a browsers’ same origin policy can be difficult, so using JSONP abstracts the difficulties and makes it easier.

JSON stands for “JavaScript Object Notation”, a format by which object fields are represented as key-value pairs which is used to represent data.</code></pre><p>JSONP 是 JSON 的一种使用模式，可以解决主流浏览器的跨域数据访问问题。其原理是根据 XmlHttpRequest 对象受到同源策略的影响，而 <code>&lt;script&gt;</code> 标签元素却不受同源策略影响，可以加载跨域服务器上的脚本，网页可以从其他来源动态产生 JSON 资料。用 JSONP 获取的不是 JSON 数据，而是可以直接运行的 JavaScript 语句。</p>
<h2 id="使用-jQuery-集成的-ajax-实现-JSONP-跨域调用"><a href="#使用-jQuery-集成的-ajax-实现-JSONP-跨域调用" class="headerlink" title="使用 jQuery 集成的 $.ajax 实现 JSONP 跨域调用"></a>使用 jQuery 集成的 $.ajax 实现 JSONP 跨域调用</h2><p>我们先从简单的实现开始，利用 jQuery 中的 $.ajax 来实现上诉的跨域调用。</p>
<p>依然是上面的例子，我们将 服务器 3000 上的请求页面的 JavaScript 代码改为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 回调函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jsonpCallback</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"jsonpCallback: "</span> + data.name)</span><br><span class="line">&#125;</span><br><span class="line">$(<span class="string">"#submit"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> data = &#123;</span><br><span class="line">        name: $(<span class="string">"#name"</span>).val(),</span><br><span class="line">        id: $(<span class="string">"#id"</span>).val()</span><br><span class="line">    &#125;;</span><br><span class="line">    $.ajax(&#123;</span><br><span class="line">        url: <span class="string">'http://localhost:3001/ajax/deal'</span>,</span><br><span class="line">        data: data,</span><br><span class="line">        dataType: <span class="string">'jsonp'</span>,</span><br><span class="line">        cache: <span class="literal">false</span>,</span><br><span class="line">        timeout: <span class="number">5000</span>,</span><br><span class="line">        <span class="comment">// jsonp 字段含义为服务器通过什么字段获取回调函数的名称</span></span><br><span class="line">        jsonp: <span class="string">'callback'</span>,</span><br><span class="line">        <span class="comment">// 声明本地回调函数的名称，jquery 默认随机生成一个函数名称</span></span><br><span class="line">        jsonpCallback: <span class="string">'jsonpCallback'</span>,</span><br><span class="line">        success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"ajax success callback: "</span> + data.name)</span><br><span class="line">        &#125;,</span><br><span class="line">        error: <span class="function"><span class="keyword">function</span>(<span class="params">jqXHR, textStatus, errorThrown</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(textStatus + <span class="string">' '</span> + errorThrown);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>服务器 3001 上对应的处理函数为：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">'/ajax/deal'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"server accept: "</span>, req.query.name, req.query.id)</span><br><span class="line">    <span class="keyword">var</span> data = <span class="string">"&#123;"</span> + <span class="string">"name:'"</span> + req.query.name + <span class="string">" - server 3001 process',"</span> + <span class="string">"id:'"</span> + req.query.id + <span class="string">" - server 3001 process'"</span> + <span class="string">"&#125;"</span></span><br><span class="line">    <span class="keyword">var</span> callback = req.query.callback</span><br><span class="line">    <span class="keyword">var</span> jsonp = callback + <span class="string">'('</span> + data + <span class="string">')'</span></span><br><span class="line">    <span class="built_in">console</span>.log(jsonp)</span><br><span class="line">    res.send(jsonp)</span><br><span class="line">    res.end()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这里一定要注意 data 中字符串拼接，不能直接将 JSON 格式的 data 直接传给回调函数，否则会发生编译错误： parsererror Error: jsonpCallback was not called。</p>
<p>其实脑海里应该有一个概念：利用 JSONP 格式返回的值一段要立即执行的 JavaScript 代码，所以不会像 ajax 的 XmlHttpRequest 那样可以监听不同事件对数据进行不同处理。</p>
<p>处理结果如下所示：</p>
<p><img src="/images/javascript-study-02/3.jpg" alt="结果"></p>
<h2 id="使用-lt-script-gt-标签原生实现-JSONP"><a href="#使用-lt-script-gt-标签原生实现-JSONP" class="headerlink" title="使用 &lt;script&gt; 标签原生实现 JSONP"></a>使用 <code>&lt;script&gt;</code> 标签原生实现 JSONP</h2><p>经过上面的事件，你是不是觉得 JSONP 的实现和 Ajax 大同小异？</p>
<p>其实，由于实现的原理不同，由 JSONP 实现的跨域调用不是通过 XmlHttpRequset 对象，而是通过 script 标签，所以在实现原理上，JSONP 和 Ajax 已经一点关系都没有了。看上去形式相似只是由于 jQuery 对 JSONP 做了封装和转换。</p>
<p>比如在上面的例子中，我们假设要传输的数据 data 格式如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    name: <span class="string">"chiaki"</span>,</span><br><span class="line">    id<span class="string">": "</span><span class="number">3001</span><span class="string">"</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<p>那么数据是如何传输的呢？HTTP 请求头的第一行如下：</p>
<p><code>GET /ajax/deal?callback=jsonpCallback&amp;name=chiaki&amp;id=3001&amp;_=1473164876032 HTTP/1.1</code></p>
<p>可见，即使形式上是用 POST 传输一个 JSON 格式的数据，其实发送请求时还是转换成 GET 请求。</p>
<p>其实如果理解 JSONP 的原理的话就不难理解为什么只能使用 GET 请求方法了。由于是通过 script 标签进行请求，所以上述传输过程根本上是以下的形式：</p>
<p><code>&lt;script src = &#39;http://localhost:3001/ajax/deal?callback=jsonpCallback&amp;name=chiaki&amp;id=3001&amp;_=1473164876032&#39;&gt;&lt;/script&gt;</code></p>
<p>这样从服务器返回的代码就可以直接在这个 script 标签中运行了。下面我们自己实现一个 JSONP：</p>
<p>服务器 3000请求页面的 JavaScript 代码中，只有回调函数 jsonpCallback：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">jsonpCallback</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"jsonpCallback: "</span>+data.name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>服务器 3000请求页面还包含一个 script 标签：</p>
<p><code>&lt;script src = &#39;http://localhost:3001/jsonServerResponse?jsonp=jsonpCallback&#39;&gt;&lt;/script&gt;</code></p>
<p>服务器 3001上对应的处理函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">'/jsonServerResponse'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> cb = req.query.jsonp</span><br><span class="line">    <span class="built_in">console</span>.log(cb)</span><br><span class="line">    <span class="keyword">var</span> data = <span class="string">'var data = &#123;'</span> + <span class="string">'name: $("#name").val() + " - server 3001 jsonp process",'</span> + <span class="string">'id: $("#id").val() + " - server 3001 jsonp process"'</span> + <span class="string">'&#125;;'</span></span><br><span class="line">    <span class="keyword">var</span> debug = <span class="string">'console.log(data);'</span></span><br><span class="line">    <span class="keyword">var</span> callback = <span class="string">'$("#submit").click(function() &#123;'</span> + data + cb + <span class="string">'(data);'</span> + debug + <span class="string">'&#125;);'</span></span><br><span class="line">    res.send(callback)</span><br><span class="line">    res.end()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>与上面一样，我们在所获取的参数后面加上 “ – server 3001 jsonp process” 代表服务器对数据的操作。从代码中我么可以看到，处理函数除了根据参数做相应的处理，更多的也是进行字符串的拼接。</p>
<p>最终的结果为：</p>
<p><img src="/images/javascript-study-02/4.jpg" alt="结果"></p>
<h2 id="JSONP-总结"><a href="#JSONP-总结" class="headerlink" title="JSONP 总结"></a>JSONP 总结</h2><p>至此，我们了解了 JSONP 的原理以及实现方式，它帮我们实现前端跨域请求，但是在实践的过程中，我们还是可以发现它的不足：</p>
<p>只能使用 GET 方法发起请求，这是由于 script 标签自身的限制决定的。<br>不能很好的发现错误，并进行处理。与 Ajax 对比，由于不是通过 XmlHttpRequest 进行传输，所以不能注册 success、 error 等事件监听函数。</p>
<h1 id="使用-CORS-实现跨域调用"><a href="#使用-CORS-实现跨域调用" class="headerlink" title="使用 CORS 实现跨域调用"></a>使用 CORS 实现跨域调用</h1><h2 id="什么是-CORS？"><a href="#什么是-CORS？" class="headerlink" title="什么是 CORS？"></a>什么是 CORS？</h2><p>Cross-Origin Resource Sharing（CORS）跨域资源共享是一份浏览器技术的规范，提供了 Web 服务从不同域传来沙盒脚本的方法，以避开浏览器的同源策略，是 JSONP 模式的现代版。与 JSONP 不同，CORS 除了 GET 要求方法以外也支持其他的 HTTP 要求。用 CORS 可以让网页设计师用一般的 XMLHttpRequest，这种方式的错误处理比 JSONP 要来的好。另一方面，JSONP 可以在不支持 CORS 的老旧浏览器上运作。现代的浏览器都支持 CORS。</p>
<h2 id="CORS-的实现"><a href="#CORS-的实现" class="headerlink" title="CORS 的实现"></a>CORS 的实现</h2><p>还是以 服务器 3000 上的请求页面向 服务器 3001 发送请求为例。</p>
<p>服务器 3000 上的请求页面 JavaScript 不变，如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    $(<span class="string">"#submit"</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> data = &#123;</span><br><span class="line">            name: $(<span class="string">"#name"</span>).val(),</span><br><span class="line">            id: $(<span class="string">"#id"</span>).val()</span><br><span class="line">        &#125;;</span><br><span class="line">        $.ajax(&#123;</span><br><span class="line">            type: <span class="string">'POST'</span>,</span><br><span class="line">            data: data,</span><br><span class="line">            url: <span class="string">'http://localhost:3001/cors'</span>,</span><br><span class="line">            dataType: <span class="string">'json'</span>,</span><br><span class="line">            cache: <span class="literal">false</span>,</span><br><span class="line">            timeout: <span class="number">5000</span>,</span><br><span class="line">            success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(data)</span><br><span class="line">            &#125;,</span><br><span class="line">            error: <span class="function"><span class="keyword">function</span>(<span class="params">jqXHR, textStatus, errorThrown</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'error '</span> + textStatus + <span class="string">' '</span> + errorThrown);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>服务器 3001上对应的处理函数：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">'/cors'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Origin"</span>, <span class="string">"*"</span>);</span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Headers"</span>, <span class="string">"X-Requested-With"</span>);</span><br><span class="line">    res.header(<span class="string">"Access-Control-Allow-Methods"</span>, <span class="string">"PUT,POST,GET,DELETE,OPTIONS"</span>);</span><br><span class="line">    res.header(<span class="string">"X-Powered-By"</span>, <span class="string">' 3.2.1'</span>)</span><br><span class="line">    res.header(<span class="string">"Content-Type"</span>, <span class="string">"application/json;charset=utf-8"</span>);</span><br><span class="line">    <span class="keyword">var</span> data = &#123;</span><br><span class="line">        name: req.body.name + <span class="string">' - server 3001 cors process'</span>,</span><br><span class="line">        id: req.body.id + <span class="string">' - server 3001 cors process'</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">    res.send(data)</span><br><span class="line">    res.end()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>在服务器中对返回信息的请求头进行了设置。</p>
<p>最终的结果为：</p>
<p><img src="/images/javascript-study-02/5.png" alt="结果"></p>
<h2 id="CORS-中属性的分析"><a href="#CORS-中属性的分析" class="headerlink" title="CORS 中属性的分析"></a>CORS 中属性的分析</h2><pre><code>Access-Control-Allow-Origin
The origin parameter specifies a URI that may access the resource. The browser must enforce this. For requests without credentials, the server may specify “*” as a wildcard, thereby allowing any origin to access the resource.
Access-Control-Allow-Methods
Specifies the method or methods allowed when accessing the resource. This is used in response to a preflight request. The conditions under which a request is preflighted are discussed above.
Access-Control-Allow-Headers
Used in response to a preflight request to indicate which HTTP headers can be used when making the actual request.</code></pre><h2 id="CORS-与-JSONP-的对比"><a href="#CORS-与-JSONP-的对比" class="headerlink" title="CORS 与 JSONP 的对比"></a>CORS 与 JSONP 的对比</h2><p>1.CORS 除了 GET 方法外，也支持其它的 HTTP 请求方法如 POST、 PUT 等。</p>
<p>2.CORS 可以使用 XmlHttpRequest 进行传输，所以它的错误处理方式比 JSONP 好。</p>
<p>3.JSONP 可以在不支持 CORS 的老旧浏览器上运作。</p>
<h1 id="一些其它的跨域调用方式"><a href="#一些其它的跨域调用方式" class="headerlink" title="一些其它的跨域调用方式"></a>一些其它的跨域调用方式</h1><h2 id="window-name"><a href="#window-name" class="headerlink" title="window.name"></a>window.name</h2><p>window对象有个name属性，该属性有个特征：即在一个窗口 (window) 的生命周期内，窗口载入的所有的页面都是共享一个 window.name 的，每个页面对 window.name 都有读写的权限，window.name 是持久存在一个窗口载入过的所有页面中的，并不会因新页面的载入而进行重置。</p>
<h2 id="window-postMessage"><a href="#window-postMessage" class="headerlink" title="window.postMessage()"></a>window.postMessage()</h2><p>这个方法是 HTML5 的一个新特性，可以用来向其他所有的 window 对象发送消息。需要注意的是我们必须要保证所有的脚本执行完才发送 MessageEvent，如果在函数执行的过程中调用了他，就会让后面的函数超时无法执行。</p>
<p>参考：<a href="https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage" target="_blank" rel="noopener">https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage</a></p>


    
    
    
	  <div class="full-width auto-padding tags">
      
        <a href="/tags/js/">js</a>
      
	  </div>
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/2019/09/17/netcore/netcore3.0_preview/">
        .NetCore3.0预览
      </a>
    </h2>
    
    <time>
      Sep 17, 2019
    </time>
		
    
    <div class='cats'>
        <a href="/categories/NetCore/">NetCore</a>
    </div>

  </section>
  <section class="article typo">
	  <p>.NET Core 3.0 正式发布将在.NET Conf 上发布，.NET Conf 时间是9月23日至25日。</p>
<p>Visual Studio 2019 16.3预览版3和Visual Studio for Mac 8.3支持.NET Core 3.0 ，这些版本也同时发布。</p>
<p>从.NET Core 3.0 Preview 7就可用于生产，目前dotnet官网就是使用 <a href="https://dotnet.microsoft.com/" target="_blank" rel="noopener">https://dotnet.microsoft.com/</a> Powered by .NET Core 3.0.0-preview9-19423-09。</p>
<p>博客园也升级为.NET Core 3.0 Preview 8，目前运行算是良好。</p>
<p>下面实际体验.NET Core 3.0 新特性。</p>
<h1 id="NET-Core-3-0"><a href="#NET-Core-3-0" class="headerlink" title=".NET Core 3.0"></a>.NET Core 3.0</h1><h2 id="System-Text-Json"><a href="#System-Text-Json" class="headerlink" title="System.Text.Json"></a>System.Text.Json</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Person</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> FirstName &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> LastName &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    <span class="keyword">public</span> DateTime? BirthDay &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//转成对象</span></span><br><span class="line"><span class="keyword">string</span> json = ...</span><br><span class="line">Person person = JsonSerializer.Parse&lt;Person&gt;(json);</span><br><span class="line"></span><br><span class="line"><span class="comment">//转成json字符串</span></span><br><span class="line">Person person = ...</span><br><span class="line"><span class="keyword">string</span> json = JsonSerializer.ToString(person);</span><br></pre></td></tr></table></figure>

<h2 id="NET-Standard-2-1"><a href="#NET-Standard-2-1" class="headerlink" title=".NET Standard 2.1"></a>.NET Standard 2.1</h2><p>要以.NET Standard 2.1为目标，必须编辑项目文件并将TargetFramework属性更改为netstandard2.1： .NET Framework不支持.NET Standard 2.1。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Project</span> <span class="attr">Sdk</span>=<span class="string">"Microsoft.NET.Sdk"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TargetFramework</span>&gt;</span>netstandard2.1<span class="tag">&lt;/<span class="name">TargetFramework</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Microsoft-Data-SqlClient"><a href="#Microsoft-Data-SqlClient" class="headerlink" title="Microsoft.Data.SqlClient"></a>Microsoft.Data.SqlClient</h2><p>Microsoft.Data.SqlClient是Microsoft Sql Server的数据提供程序。</p>
<p>它是两个System.Data.SqlClient组件的联合体，独立存在于.NET Framework和.NET Core中。</p>
<p>最新版本安装</p>
<p><code>Install-Package Microsoft.Data.SqlClient</code></p>
<p><code>https://github.com/dotnet/SqlClient</code></p>
<h2 id="发布成单个程序"><a href="#发布成单个程序" class="headerlink" title="发布成单个程序"></a>发布成单个程序</h2><p><code>dotnet publish -r win10-x64 /p:PublishSingleFile=true</code></p>
<h2 id="Alpine-Docker-images"><a href="#Alpine-Docker-images" class="headerlink" title="Alpine Docker images"></a>Alpine Docker images</h2><p><code>.NET Core and ASP.NET Core on ARM64</code></p>
<p><code>docker pull mcr.microsoft.com/dotnet/core/runtime:3.0-alpine-arm64v8</code></p>
<p><code>docker pull mcr.microsoft.com/dotnet/core/aspnet:3.0-alpine-arm64v8</code></p>
<h2 id="dotnet-counters"><a href="#dotnet-counters" class="headerlink" title="dotnet-counters"></a>dotnet-counters</h2><p>安装 ： dotnet tool install –global dotnet-counters –version 3.0.0-preview8.19412.1</p>
<p>使用示例：</p>
<p>显示所有信息</p>
<p>dotnet-counters monitor –process-id 1902 System.Runtime</p>
<p>显示CPU使用 GC 及异常数</p>
<p>dotnet-counters monitor –process-id 1902 System.Runtime[cpu-usage,gc-heap-size,exception-count]</p>
<p>官方文档：<a href="https://github.com/dotnet/diagnostics/blob/master/documentation/dotnet-counters-instructions.md" target="_blank" rel="noopener">https://github.com/dotnet/diagnostics/blob/master/documentation/dotnet-counters-instructions.md</a></p>
<h2 id="ReadyToRun"><a href="#ReadyToRun" class="headerlink" title="ReadyToRun"></a>ReadyToRun</h2><p>你可以通过将应用程序集编译为ReadyToRun（R2R）格式来缩短.NET Core应用程序的启动时间。R2R是一种提前（AOT）编译的形式。</p>
<p>示例提升：</p>
<p>仅限IL的应用：</p>
<p>启动时间：1.9秒<br>内存使用量：69.1 MB<br>应用程序大小：150 MB<br>使用ReadyToRun图像：</p>
<p>启动时间：1.3秒。<br>内存使用量：55.7 MB<br>应用程序大小：156 MB<br>要启用ReadyToRun编译 需要以下操作：</p>
<p>将PublishReadyToRun属性设置为true。 使用显式发布RuntimeIdentifier。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Project</span> <span class="attr">Sdk</span>=<span class="string">"Microsoft.NET.Sdk"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">OutputType</span>&gt;</span>Exe<span class="tag">&lt;/<span class="name">OutputType</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TargetFramework</span>&gt;</span>netcoreapp3.0<span class="tag">&lt;/<span class="name">TargetFramework</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">PublishReadyToRun</span>&gt;</span>true<span class="tag">&lt;/<span class="name">PublishReadyToRun</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">PropertyGroup</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>dotnet publish -r win-x64 -c Release</p>
<p>ReadyToRun编译器目前不支持交叉定位。需要在给定目标上进行编译。例如，如果想要Windows x64的R2R程序，则需要在该环境中运行publish命令。</p>
<h2 id="IL-linker"><a href="#IL-linker" class="headerlink" title="IL linker"></a>IL linker</h2><p>使用IL linker 可以将程序大小从大约68MB减少到大约28MB</p>
<p>dotnet publish -r win10-x64 -c Release /p:PublishTrimmed=true /p:PublishSingleFile=true</p>
<h2 id="HttpClient支持HTTP-2"><a href="#HttpClient支持HTTP-2" class="headerlink" title="HttpClient支持HTTP/2"></a>HttpClient支持HTTP/2</h2><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> client = <span class="keyword">new</span> HttpClient() &#123; BaseAddress = <span class="keyword">new</span> Uri(<span class="string">"https://localhost:5001"</span>) &#125;;</span><br><span class="line"><span class="comment">// HTTP/1.1 request</span></span><br><span class="line"><span class="keyword">using</span> (<span class="keyword">var</span> response = <span class="keyword">await</span> client.GetAsync(<span class="string">"/"</span>))</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(response.Content);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// HTTP/2 request</span></span><br><span class="line"><span class="keyword">using</span> (<span class="keyword">var</span> request = <span class="keyword">new</span> HttpRequestMessage(HttpMethod.Get, <span class="string">"/"</span>) &#123; Version = <span class="keyword">new</span> Version(<span class="number">2</span>, <span class="number">0</span>) &#125;)</span><br><span class="line"><span class="keyword">using</span> (<span class="keyword">var</span> response = <span class="keyword">await</span> client.SendAsync(request))</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(response.Content);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="ASP-NET-Core-3-0"><a href="#ASP-NET-Core-3-0" class="headerlink" title="ASP.NET Core 3.0"></a>ASP.NET Core 3.0</h1><p>ASP.NET Core 3.0中主要更新还是Blazor和gRPC</p>
<h2 id="Blazor"><a href="#Blazor" class="headerlink" title="Blazor"></a>Blazor</h2><p>Blazor 是一个用于使用 .NET 生成交互式客户端 Web UI 的框架：</p>
<p>使用 C# 代替 JavaScript 来创建丰富的交互式 UI。</p>
<p>共享使用 .NET 编写的服务器端和客户端应用逻辑。</p>
<p>将 UI 呈现为 HTML 和 CSS，以支持众多浏览器，其中包括移动浏览器。</p>
<p>使用 .NET 进行客户端 Web 开发可提供以下优势：</p>
<p>使用 C# 代替 JavaScript 来编写代码。</p>
<p>利用现有的 .NET 库生态系统。</p>
<p>在服务器和客户端之间共享应用逻辑。</p>
<p>受益于 .NET 的性能、可靠性和安全性。</p>
<p>始终高效支持 Windows、Linux 和 macOS 上的 Visual Studio。</p>
<p>以一组稳定、功能丰富且易用的通用语言、框架和工具为基础来进行生成。</p>
<p>Blazor 应用基于组件 。 Blazor 中的组件是指 UI 元素，例如，页面、对话框或数据输入窗体。</p>
<p>组件类通常以 Razor 标记页（文件扩展名为 .razor ）的形式编写。 Blazor 中的组件有时被称为 Razor 组件 。</p>
<p>Razor 标记演示组件：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    &lt;h1&gt;@Title&lt;/h1&gt;</span><br><span class="line">    @ChildContent</span><br><span class="line">    &lt;button @onclick=<span class="string">"OnYes"</span>&gt;Yes!&lt;/button&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">@code &#123;</span><br><span class="line">    [<span class="meta">Parameter</span>]</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">string</span> Title &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">Parameter</span>]</span><br><span class="line">    <span class="keyword">public</span> RenderFragment ChildContent &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">OnYes</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">"Write to the console in C#! 'Yes' button was selected.From LineZero"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>对话框的正文内容 (ChildContent) 和标题 (Title) 由在其 UI 中使用此组件的组件提供。 OnYes 是由按钮的 onclick 事件触发的 C# 方法。</p>
<p>Blazor 使用 UI 构成的自然 HTML 标记。 HTML 元素指定组件，并且标记的特性将值传递给组件的属性。</p>
<p>在以下示例中，Index 组件中使用上面的 Dialog 组件。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@page <span class="string">"/"</span></span><br><span class="line">&lt;h1&gt;Hello, world!&lt;/h1&gt;</span><br><span class="line">Welcome to your <span class="keyword">new</span> app.</span><br><span class="line">&lt;Dialog Title=<span class="string">"Blazor"</span>&gt;</span><br><span class="line">    Do you want to &lt;i&gt;learn more&lt;/i&gt; about Blazor?</span><br><span class="line">　　 From LineZero</span><br><span class="line">&lt;/Dialog&gt;</span><br></pre></td></tr></table></figure>

<p>更多官方介绍：<a href="https://docs.microsoft.com/zh-cn/aspnet/core/blazor/get-started?view=aspnetcore-3.0&amp;tabs=visual-studio" target="_blank" rel="noopener">https://docs.microsoft.com/zh-cn/aspnet/core/blazor/get-started?view=aspnetcore-3.0&amp;tabs=visual-studio</a></p>
<h2 id="gRPC"><a href="#gRPC" class="headerlink" title="gRPC"></a>gRPC</h2><p>gRPC 的主要优点是：</p>
<p>现代高性能轻量级 RPC 框架。</p>
<p>协定优先 API 开发，默认使用协议缓冲区，允许与语言无关的实现。</p>
<p>可用于多种语言的工具，以生成强类型服务器和客户端。</p>
<p>支持客户端、服务器和双向流式处理调用。</p>
<p>使用 Protobuf 二进制序列化减少对网络的使用。</p>
<p>这些优点使 gRPC 适用于：</p>
<p>效率至关重要的轻量级微服务。</p>
<p>需要多种语言用于开发的 Polyglot 系统。</p>
<p>需要处理流式处理请求或响应的点对点实时服务。</p>
<p>虽然 C# 实现目前在官方 gRPC 上有介绍，但当前实现依赖于用 C (gRPC C-core) 编写的本机库。 </p>
<p>目前正在基于 Kestrel HTTP 服务器和完全托管的 ASP.NET Core 实现gRPC。</p>


    
    
    
	  <div class="full-width auto-padding tags">
      
        <a href="/tags/C/">C#</a>
      
        <a href="/tags/NetCore/">NetCore</a>
      
	  </div>
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/2019/09/17/javascript/javascript-study-01/">
        javascript学习-01(Console)
      </a>
    </h2>
    
    <time>
      Sep 17, 2019
    </time>
		
    
    <div class='cats'>
        <a href="/categories/JavaScript/">JavaScript</a>
    </div>

  </section>
  <section class="article typo">
	  <h1 id="Console"><a href="#Console" class="headerlink" title="Console"></a>Console</h1><p>我们经常会在浏览器中使用<code>console.log</code>来进行调试和参数的输出查看，但是<code>console</code>其实是一个非常丰富的封装，其中还有很多的方法，今天就来介绍一下。<br>首先，我们先看一下<code>console</code>的代码<br><img src="/images/javascript-study-01/11738664-81199621a81286e1.png" alt="console结构"></p>
<p>下面就介绍一下，我们会用到的可以提高我们开发效率，调试效率的方法。</p>
<h2 id="console-log"><a href="#console-log" class="headerlink" title="console.log()"></a>console.log()</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//平时我们使用的时候会这样</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"测试内容不要当真"</span>);</span><br><span class="line"><span class="comment">//或者这样</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line"><span class="comment">//或者这样</span></span><br><span class="line"><span class="built_in">console</span>.log(&#123;<span class="attr">name</span>:<span class="number">1</span>&#125;)</span><br></pre></td></tr></table></figure>

<p>上面我们使用的格式为<code>console.log(object)</code>,<code>console.log(object, otherObject, string)</code><br>除了这些基础用法还有比较好玩的用法<br><code>console.log(msg, values)</code>,这个格式的用法有点像C++的printf,C#的Console.Write()等<br>那么我们来看看怎么使用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//首先我们使用了3种占位符</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"我今天吃了%o,你吃了%d顿,你叫%s."</span>, <span class="string">"Skittles"</span>, <span class="number">22</span>,<span class="string">"Kalan"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//%o的复杂传值</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"abc %o"</span>,&#123;<span class="attr">name</span>:<span class="number">1</span>&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="/images/javascript-study-01/11738664-e16ae0b53ee2ce75.png" alt="效果"><br><img src="/images/javascript-study-01/11738664-88655740385f9fa7.png" alt="效果2"></p>
<p>我们看一下效果<br>可以看到<code>%o</code>这个是对象占位符,<code>%s</code>这个是字符串占位符,<code>%d</code>这个是数字占位符</p>
<p>下面我们讲解一个更好玩的占位符<code>%c</code>，先上代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(</span><br><span class="line">    <span class="string">"我爱你 %c路西"</span> one day,</span><br><span class="line">    <span class="string">"color: Red; background-color: orange; padding: 2px 5px; border-radius: 2px"</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><img src="/images/javascript-study-01/11738664-22c5e6cdc4c19285.png" alt="图片.png"><br>看到这里，应该明白，这个占位符当你使用之后，后面所有的文字都将根据此CSS渲染<code>%o</code>除外</p>
<h2 id="console-dir"><a href="#console-dir" class="headerlink" title="console.dir()"></a>console.dir()</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//直接上例子</span></span><br><span class="line"><span class="built_in">console</span>.dir(<span class="built_in">document</span>.getElementsByClassName(<span class="string">"full"</span>)[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">document</span>.getElementsByClassName(<span class="string">"full"</span>)[<span class="number">0</span>])</span><br></pre></td></tr></table></figure>

<p><img src="/images/javascript-study-01/11738664-b3afca936115d49a.png" alt="结果"><br><img src="/images/javascript-study-01/11738664-23a8511207cf4d93.png" alt="图片.png"></p>
<p>我们看到结果<code>console.log</code>直接输出的html，而<code>console.dir</code>输出的是DOM结构树对象</p>
<h2 id="console-warn"><a href="#console-warn" class="headerlink" title="console.warn()"></a>console.warn()</h2><p><img src="/images/javascript-study-01/11738664-cd3f0ab443607aaf.png" alt="图片.png"><br>这个函数直接会输出一个警告框，可以定位到输出位置</p>
<h2 id="console-table"><a href="#console-table" class="headerlink" title="console.table()"></a>console.table()</h2><p>这个函数能更好的显示列表型数据，我们用<code>console.log</code>显示对比一下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.table([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>],[<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])</span><br><span class="line"><span class="built_in">console</span>.table(&#123;<span class="attr">name</span>:<span class="number">1</span>,<span class="attr">age</span>:<span class="number">2</span>&#125;,&#123;<span class="attr">name</span>:<span class="number">11</span>,<span class="attr">age</span>:<span class="number">22</span>&#125;,&#123;<span class="attr">name</span>:<span class="number">11</span>,<span class="attr">age</span>:<span class="number">22</span>&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="/images/javascript-study-01/11738664-02ccb6c6f99fb7c8.png" alt="对比图"></p>
<p><img src="/images/javascript-study-01/11738664-8058b1115fd0b077.png" alt="图片.png"></p>
<h2 id="console-assert"><a href="#console-assert" class="headerlink" title="console.assert()"></a>console.assert()</h2><p><img src="/images/javascript-study-01/11738664-bba5aca58df2db11.png" alt="图片.png"></p>
<p><img src="/images/javascript-study-01/11738664-39beb2a9e381b456.png" alt="图片.png"></p>
<p>可以传递2个参数：如果为false会输出<code>Assertion failed</code>和第二个参数（如上图所示）</p>
<h2 id="console-count"><a href="#console-count" class="headerlink" title="console.count"></a>console.count</h2><p><code>count</code>只是作为一个计数器，或者作为一个命名计数器，可以统计代码被执行的次数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (i % <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="built_in">console</span>.count(<span class="string">"odds"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!(i % <span class="number">5</span>)) &#123;</span><br><span class="line">        <span class="built_in">console</span>.count(<span class="string">"multiplesOfFive"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (isPrime(i)) &#123;</span><br><span class="line">        <span class="built_in">console</span>.count(<span class="string">"prime"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="console-trace"><a href="#console-trace" class="headerlink" title="console.trace()"></a>console.trace()</h2><p><code>trace</code> 可以调试模块之间的调用</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">CupcakeService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>(dataLib) &#123;</span><br><span class="line">    <span class="keyword">this</span>.dataLib = dataLib;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> dataLib !== <span class="string">'object'</span>) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(dataLib);</span><br><span class="line">      <span class="built_in">console</span>.trace();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里使用 <code>console.log()</code>仅告诉我们传递数据dataLib是什么 ，而没有具体的传递的路径。不过，<code>console.trace()</code>会非常清楚地告诉我们问题出在 <code>Dashboard.js</code>，我们可以看到是 <code>new CupcakeService(false)</code>导致错误。</p>
<h2 id="console-time"><a href="#console-time" class="headerlink" title="console.time()"></a>console.time()</h2><p>console.time() 是一个用于跟踪操作时间的专用函数，它是跟踪 JavaScript 执行时间的好方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">slowFunction</span>(<span class="params">number</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> functionTimerStart = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">    <span class="comment">// something slow or complex with the numbers.</span></span><br><span class="line">    <span class="comment">// Factorials, or whatever.</span></span><br><span class="line">    <span class="keyword">var</span> functionTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() - functionTimerStart;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`Function time: <span class="subst">$&#123;functionTime&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> start = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; ++i) &#123;</span><br><span class="line">    slowFunction(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> time = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime() - start;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`Execution time: <span class="subst">$&#123;time&#125;</span>`</span>);</span><br></pre></td></tr></table></figure>

<p>这是一种老派的做法，我们使用 <code>console.time()</code>来简化以上代码。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> slowFunction = <span class="function"><span class="params">number</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.time(<span class="string">"slowFunction"</span>);</span><br><span class="line">    <span class="comment">// something slow or complex with the numbers.</span></span><br><span class="line">    <span class="comment">// Factorials, or whatever.</span></span><br><span class="line">    <span class="built_in">console</span>.timeEnd(<span class="string">"slowFunction"</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.time();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; ++i) &#123;</span><br><span class="line">    slowFunction(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.timeEnd();</span><br></pre></td></tr></table></figure>

<h2 id="console-group"><a href="#console-group" class="headerlink" title="console.group()"></a>console.group()</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// this is the global scope</span></span><br><span class="line"><span class="keyword">let</span> number = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">console</span>.group(<span class="string">"OutsideLoop"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(number);</span><br><span class="line"><span class="built_in">console</span>.group(<span class="string">"Loop"</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">    number = i + number;</span><br><span class="line">    <span class="built_in">console</span>.log(number);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.groupEnd();</span><br><span class="line"><span class="built_in">console</span>.log(number);</span><br><span class="line"><span class="built_in">console</span>.groupEnd();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"All done now"</span>);</span><br></pre></td></tr></table></figure>

<p>输出如下：</p>
<p><img src="/images/javascript-study-01/3973862-b82745c286f40c52.png" alt="image"></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(dataAccess) &#123;</span><br><span class="line">        <span class="built_in">console</span>.group(<span class="string">"Constructor"</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Constructor executed"</span>);</span><br><span class="line">        <span class="built_in">console</span>.assert(</span><br><span class="line">            <span class="keyword">typeof</span> dataAccess === <span class="string">"object"</span>,</span><br><span class="line">            <span class="string">"Potentially incorrect dataAccess object"</span></span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">this</span>.initializeEvents();</span><br><span class="line">        <span class="built_in">console</span>.groupEnd();</span><br><span class="line">    &#125;</span><br><span class="line">    initializeEvents() &#123;</span><br><span class="line">        <span class="built_in">console</span>.group(<span class="string">"events"</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Initialising events"</span>);</span><br><span class="line">        <span class="built_in">console</span>.groupEnd();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> myClass = <span class="keyword">new</span> MyClass(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>



    
    
    
	  <div class="full-width auto-padding tags">
      
        <a href="/tags/js/">js</a>
      
	  </div>
    
  </section>
</article>
    </div>
  
    <div class='post-wrapper'>
      <article class="post reveal">
  <section class="meta">
    
    <h2 class="title">
      <a href="/2019/09/17/hello-world/">
        Hello World
      </a>
    </h2>
    
    <time>
      Sep 17, 2019
    </time>
		
    
    <div class='cats'>
        <a href="/categories/测试/">测试</a>
    </div>

  </section>
  <section class="article typo">
	  <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>


    
    
    
  </section>
</article>
    </div>
  
</section>



      </div>
      <aside class='l_side'>
        
  <section class='m_widget about'>

<img class='avatar waves-image' src='/images/avatar.jpg' />

<div class='header'>Kalan</div>
<div class='content'>
<div class='desc'>Do you like kiki</div>
</div>
</section>

  <section class='m_widget links'>
<div class='header'>Links</div>
<div class='content'>
    <ul class="entry">
    
        <li><a class="flat-box" target="_blank" href="https://ccoooss.com">
            <div class='name'>ClassicOldSong</div>
        </a></li>
    
        <li><a class="flat-box" target="_blank" href="https://frantic1048.logdown.com/">
            <div class='name'>Frantic1048</div>
        </a></li>
    
        <li><a class="flat-box" target="_blank" href="https://hclmaster.github.io/">
            <div class='name'>Hclmaster</div>
        </a></li>
    
        <li><a class="flat-box" target="_blank" href="https://whst.github.io/">
            <div class='name'>WANG Hsü-Tung</div>
        </a></li>
    
    </ul>
</div>
</section>

  <section class='m_widget categories'>
<div class='header'>Categories</div>
<div class='content'>
    
    <ul class="entry">
    
        <li><a class="flat-box" href="/categories/Collect/"><div class='name'>Collect</div><div class='badget'>1</div></a></li>
    
        <li><a class="flat-box" href="/categories/JavaScript/"><div class='name'>JavaScript</div><div class='badget'>2</div></a></li>
    
        <li><a class="flat-box" href="/categories/NetCore/"><div class='name'>NetCore</div><div class='badget'>3</div></a></li>
    
        <li><a class="flat-box" href="/categories/信条/"><div class='name'>信条</div><div class='badget'>1</div></a></li>
    
        <li><a class="flat-box" href="/categories/测试/"><div class='name'>测试</div><div class='badget'>1</div></a></li>
    
    </ul>
    
</div>
</section>

  
<div class="m_widget tagcloud">
    <div class="header">Tags</div>
    <div class='content'>
        <a href="/tags/C/" style="font-size: 20px; color: #000">C#</a> <a href="/tags/NetCore/" style="font-size: 20px; color: #000">NetCore</a> <a href="/tags/js/" style="font-size: 17px; color: #404040">js</a> <a href="/tags/regex/" style="font-size: 14px; color: #808080">regex</a> <a href="/tags/马云-Jack-MA/" style="font-size: 14px; color: #808080">马云,Jack MA</a>
    </div>
</div>



      </aside>
      <script>setLoadingBarProgress(60);</script>
    </div>
  </div>
  <footer id="footer" class="clearfix">

	<div class="social-wrapper">
  	
      
        <a href="https://github.com/stkevintan" class="social github"
          target="_blank" rel="external">
          <span class="icon icon-github"></span>
        </a>
      
        <a href="https://twitter.com/kevinsfork" class="social twitter"
          target="_blank" rel="external">
          <span class="icon icon-twitter"></span>
        </a>
      
        <a href="/atom.xml" class="social rss"
          target="_blank" rel="external">
          <span class="icon icon-rss"></span>
        </a>
      
    
  </div>
  
  <div>Theme <a href='https://github.com/stkevintan/hexo-theme-material-flow' class="codename">MaterialFlow</a> designed by <a href="http://keyin.me/" target="_blank">Kevin Tan</a>.</div>
  
</footer>


  <script>setLoadingBarProgress(80);</script>
  

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src='//cdn.bootcss.com/node-waves/0.7.5/waves.min.js'></script>
<script src="//cdn.bootcss.com/scrollReveal.js/3.3.2/scrollreveal.min.js"></script>
<script src="/js/jquery.fitvids.js"></script>
<script>
	var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
	var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
	var ALGOLIA_API_KEY = "";
	var ALGOLIA_APP_ID = "";
	var ALGOLIA_INDEX_NAME = "";
  var AZURE_SERVICE_NAME = "";
  var AZURE_INDEX_NAME = "";
  var AZURE_QUERY_KEY = "";
  var BAIDU_API_ID = "";
  var SEARCH_SERVICE = "hexo";
  var ROOT = "/"||"/";
  if(!ROOT.endsWith('/'))ROOT += '/';
</script>
<script src="/js/search.js"></script>
<script src="/js/app.js"></script>


  <script>setLoadingBarProgress(100);</script>
</body>
</html>
